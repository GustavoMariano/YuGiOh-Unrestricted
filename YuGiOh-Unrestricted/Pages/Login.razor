@page "/login"
@inject NavigationManager Nav
@inject AppState App
@inject YuGiOh_Unrestricted.Infrastructure.Data.GameDbContext Db

<h3>Login</h3>

<div class="join-container">
    <input @bind="nickname" placeholder="Nickname" />
    <input @bind="password" type="password" placeholder="Password" />
    <button @onclick="DoLogin">Login</button>
</div>

@code {
    private string nickname = "";
    private string password = "";

    private async Task DoLogin()
    {
        if (string.IsNullOrWhiteSpace(nickname) || string.IsNullOrWhiteSpace(password)) return;

        // login simples (sem Identity) – cria user se não existir
        var user = Db.Users.FirstOrDefault(u => u.Nickname == nickname);
        if (user == null)
        {
            user = new YuGiOh_Unrestricted.Core.Models.User { Nickname = nickname, PasswordHash = password };
            Db.Users.Add(user);
            await Db.SaveChangesAsync();
        }

        App.Nickname = user.Nickname;
        App.UserId = user.Id;

        Nav.NavigateTo("/lobby");
    }
}
